<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: plugin/custom/c.underscore.plugin.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: plugin/custom/c.underscore.plugin.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @Description  underscroe的扩展方法
 * @date  2013/6/23 16:26:12
 * @version V1.0
 */

define(['underscore','jquery'],function () {

  // 全局可能用到的变量
  var arr = [];
  var slice = arr.slice;
  /**
   * inherit方法，js的继承，默认为两个参数
   * @method _.inherit
   * @see cCoreInherit.Class
   * @deprecated
   */
  _.inherit = function (origin, methods) {

    // 参数检测，该继承方法，只支持一个参数创建类，或者两个参数继承类
    if (arguments.length === 0 || arguments.length > 2) {throw '参数错误';}

    var parent = null;

    // 将参数转换为数组
    var properties = slice.call(arguments);

    // 如果第一个参数为类（function），那么就将之取出
    if (typeof properties[0] === 'function'){
      parent = properties.shift();
    }
    properties = properties[0];

    // 创建新类用于返回
    function klass() {
      if (_.isFunction(this.initialize)) {
        this.initialize.apply(this, arguments);
      }
    }

    klass.superclass = parent;

    // 父类的方法不做保留，直接赋给子类
    // parent.subclasses = [];

    if (parent) {
      // 中间过渡类，防止parent的构造函数被执行
      var Subclass = function () {
      };
      Subclass.prototype = parent.prototype;
      klass.prototype = new Subclass();

      // 父类的方法不做保留，直接赋给子类
      // parent.subclasses.push(klass);
    }

    var ancestor = klass.superclass &amp;&amp; klass.superclass.prototype;
    for (var k in properties) {
      var value = properties[k];

      //满足条件就重写
      if (ancestor &amp;&amp; typeof value == 'function') {
        var argslist = /^\s*function\s*\(([^\(\)]*?)\)\s*?\{/i.exec(value.toString())[1].replace(/\s/g, '').split(',');
        //只有在第一个参数为$super情况下才需要处理（是否具有重复方法需要用户自己决定）
        if (argslist[0] === '$super' &amp;&amp; ancestor[k]) {
          value = getValue(k, value);
        }
      }

      //此处对对象进行扩展，当前原型链已经存在该对象，便进行扩展
      if (_.isObject(klass.prototype[k]) &amp;&amp; _.isObject(value) &amp;&amp; (typeof klass.prototype[k] != 'function' &amp;&amp; typeof value != 'function')) {
        //原型链是共享的，这里处理逻辑要改
        var temp = {};
        _.extend(temp, klass.prototype[k]);
        _.extend(temp, value);
        klass.prototype[k] = temp;
      } else {
        klass.prototype[k] = value;
      }

    }
    function getValue(methodName, fn){
      return function () {
        var scope = this;
        var args = [
          function () {
            return ancestor[methodName].apply(scope, arguments);
          }
        ];
        return fn.apply(this, args.concat(slice.call(arguments)));
      };
    }

    if (!klass.prototype.initialize) {
      klass.prototype.initialize = function () {
      };
    }
    klass.prototype.constructor = klass;

    return klass;
  };

//flip手势工具
  (function () {

    //偏移步长
    var step = 20;

    var touch = {};
    var down = 'touchstart';
    var move = 'touchmove';
    var up = 'touchend';
    if (!('ontouchstart' in window)) {
      down = 'mousedown';
      move = 'mousemove';
      up = 'mouseup';
    }

    //简单借鉴ccd思维做简要处理
    function swipeDirection(x1, x2, y1, y2, sensibility) {

      //x移动的步长
      var _x = Math.abs(x1 - x2);
      //y移动步长
      var _y = Math.abs(y1 - y2);
      var dir = _x >= _y ? (x1 - x2 > 0 ? 'left' : 'right') : (y1 - y2 > 0 ? 'up' : 'down');

      //设置灵敏度限制
      if (sensibility) {
        if (dir == 'left' || dir == 'right') {
          if ((_y / _x) > sensibility) {dir = '';}
        } else if (dir == 'up' || dir == 'down') {
          if ((_x / _y) > sensibility) {dir = '';}
        }
      }
      return dir;
    }

    /**
     * 手指滑动函数, 这个函数在Android表现不行，``需要重构``
     * @method $.flip
     * @param {object} el jQuery对象
     * @param {string} dir 方向, left, right, up, down
     * @param {function} fn 回调函数
     * @param {function|boolean} noDefault 是否不阻止事件冒泡
     * @param {number} sensibility 设置灵敏度，值为0-1
     * @param {number} stepSet 设置步长
     * @example
     * $.flip(el, 'left', function() {}); // 这样注册后会阻止页面向上向下滚动
     * $.flip(el, 'left', function() {}, true); // 这样不阻止了，但是andriod事件也不能监听了
     */
    function flip(el, dir, fn, noDefault, sensibility, stepSet) {
      if (!el || !el[0]) {return;}
      var _dir = '', _step = stepSet || step;

      /*
       这里原来的逻辑是绑定几次flip便会执行几次，这里做一次优化
       */
      el[0]['__flip_' + dir] = fn;
      if (el[0].__hasFlipEvent) {
        return;
      }
      el[0].__hasFlipEvent = true;

      //var _step = sensibility || step;
      el.on(down, function (e) {
        e.touches = e.touches || e.originalEvent.touches;
        var pos = (e.touches &amp;&amp; e.touches[0]) || e;
        touch.x1 = pos.pageX;
        touch.y1 = pos.pageY;

      }).on(move, function (e) {

        var pos = (e.touches &amp;&amp; e.touches[0]) || e;
        touch.x2 = pos.pageX;
        touch.y2 = pos.pageY;

        //如果view过长滑不动是有问题的
        //if (!noDefault) { e.preventDefault(); }
        if ((touch.x2 &amp;&amp; Math.abs(touch.x1 - touch.x2) > _step) ||
          (touch.y2 &amp;&amp; Math.abs(touch.y1 - touch.y2) > _step)) {
          _dir = swipeDirection(touch.x1, touch.x2, touch.y1, touch.y2, sensibility);
        }
        var preventDefultFlag = typeof noDefault == 'function' ? noDefault(_dir) : noDefault;
        if (!preventDefultFlag) {
          e.preventDefault();
        }
      }).on(up, function (e) {
        e.changedTouches = e.changedTouches || e.originalEvent.changedTouches;
        var pos = (e.changedTouches &amp;&amp; e.changedTouches[0]) || e;
        touch.x2 = pos.pageX;
        touch.y2 = pos.pageY;

        if ((touch.x2 &amp;&amp; Math.abs(touch.x1 - touch.x2) > _step) ||
          (touch.y2 &amp;&amp; Math.abs(touch.y1 - touch.y2) > _step)) {
          var _dir = swipeDirection(touch.x1, touch.x2, touch.y1, touch.y2, sensibility);

          if (_.isFunction(el[0]['__flip_' + _dir])) {
            el[0]['__flip_' + _dir]();
          }

        } else {

          if (_.isFunction(el[0]['__flip_tap'])) {
            el[0]['__flip_tap']();
          }
        }
        //l_wang 每次up后皆重置
        touch = {};
      });
    }

    /**
     * 注销手指滑动函数
     * @method $.flipDestroy
     * @param {object} el jQuery对象
     * @example
     * $.flipDestroy(el);
     */
    function flipDestroy(el) {
      if (!el || !el[0]) {return;}

      el.off(down).off(move).off(up);
      if (el[0].__hasFlipEvent) {delete el[0].__hasFlipEvent;}
      if (el[0].__flip_left) {delete el[0].__flip_left;}
      if (el[0].__flip_right) {delete el[0].__flip_right;}
    }
    /**
     * 手指滑动函数, 这个函数在Android表现不行，``需要重构``
     * @method _.flip
     * @see $.flip
     * @deprecated
     */
    _.flip = flip;
    /**
     * 注销手指滑动函数
     * @method _.flipDestroy
     * @see $.flipDestroy
     * @deprecated
     */
    _.flipDestroy = flipDestroy;
    $.flip = flip;
    $.flipDestroy = flipDestroy;
  })();

//日期操作类
  (function () {

    /**
     * 静态日期操作类，封装系列日期操作方法.
     * @namespace
     */
    _.dateUtil = {
      /**
       * @description 1-9返回01,02,...
       * @param {number} n
       * @return {string} 返回处理后的数字
       * @example
       * \_.dateUtil.formatNum(5)   // 05
       * \_.dateUtil.formatNum(5)   // 10
       */
      formatNum         : function (n) {
        if (n &lt; 10) {return '0' + n;}
        return n.toString();
      },
      /**
       * @description 将字符串转换为日期，支持格式y-m-d ymd (y m r)以及标准的
       * @return {Date} 返回日期对象
       */
      parse             : function (dateStr, formatStr) {
        if (typeof dateStr === 'undefined') {return null;}
        if (typeof formatStr === 'string') {
          var _d = new Date(formatStr);
          //首先取得顺序相关字符串
          var arrStr = formatStr.replace(/[^ymd]/g, '').split('');
          if (!arrStr &amp;&amp; arrStr.length != 3) {return null;}

          formatStr = formatStr.replace(/y|m|d/g, function (k) {
            switch (k) {
              case 'y':
                return '(\\d{4})';
              case 'm':
              case 'd':
                return '(\\d{1,2})';
            }
          });

          var reg = new RegExp(formatStr, 'g');
          var arr = reg.exec(dateStr);

          var dateObj = {};
          for (var i = 0, len = arrStr.length; i &lt; len; i++) {
            dateObj[arrStr[i]] = arr[i + 1];
          }
          return new Date(dateObj['y'], dateObj['m'] - 1, dateObj['d']);
        }
        return null;
      },
      /**
       * @description将日期格式化为字符串
       * @param {date} date 时间对象
       * @param {string} [format=Y年M月D日 H时F分S秒] 格式化结构
       * @return {string} 常用格式化字符串
       * @example
       * var d = new Date();
       * \_.dateUtil.format(d, 'Y/m/d');
       * \_.dateUtil.format(d, 'Y/m/d h:f:s');
       */
      format            : function (date, format) {
        if (arguments.length &lt; 2 &amp;&amp; !date.getTime) {
          format = date;
          date = new Date();
        }
        if(typeof format != 'string' ){
          (format = 'Y年M月D日 H时F分S秒');
        }
        return format.replace(/Y|y|M|m|D|d|H|h|F|f|S|s/g, function (a) {
          switch (a) {
            case "y":
              return (date.getFullYear() + "").slice(2);
            case "Y":
              return date.getFullYear();
            case "m":
              return date.getMonth() + 1;
            case "M":
              return _.dateUtil.formatNum(date.getMonth() + 1);
            case "d":
              return date.getDate();
            case "D":
              return _.dateUtil.formatNum(date.getDate());
            case "h":
              return date.getHours();
            case "H":
              return _.dateUtil.formatNum(date.getHours());
            case "f":
              return date.getMinutes();
            case "F":
              return _.dateUtil.formatNum(date.getMinutes());
            case "s":
              return date.getSeconds();
            case "S":
              return _.dateUtil.formatNum(date.getSeconds());
          }
        });
      },
      /**
       * 判断是不是时间对象
       * @method _.dateUtil.isDate
       * @see http://underscorejs.org/#isDate
       * @deprecated
       */
      isDate            : _.isDate,
      /**
       * 是否为闰年
       * @param {num|date} year
       * @return {boolean} 返回值
       * @example
       * \_.dateUtil.isLeapYear(new Date());
       * \_.dateUtil.isLeapYear(2015);
       */
      isLeapYear        : function (year) {
        //传入为时间格式需要处理
        if (_.isDate(year)) {year = year.getFullYear();}
        if ((year % 4 === 0 &amp;&amp; year % 100 !== 0) || (year % 400 === 0)) {return true;}
        return false;
      },

      /**
       * 获取一个月份的天数
       * @param {num|date} year
       * @param {num} [month] 月份
       * @return {num} 返回天数
       * @example
       * \_.dateUtil.getDaysOfMonth(new Date());  // 当前时间
       * \_.dateUtil.getDaysOfMonth(2014, 3);     // 2014, 3月份
       */
      getDaysOfMonth    : function (year, month) {
        //自动减一以便操作
        if (_.isDate(year)) {
          month = year.getMonth(); //注意此处月份要加1，所以我们要减一
          year = year.getFullYear();
        } else {
          month--;
        }
        return [31, _.dateUtil.isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];
      },

      /**
       * 获取一个月份1号是星期几，注意此时的月份传入时需要自主减一
       * @param {num|date} year 可能是年份或者为一个date时间
       * @param {num} [month] 月份
       * @return {num} 当月一号为星期几，0是星期天，1是星期一
       * @example
       * \_.dateUtil.getBeginDayOfMouth(new Date());  // 当前月份一号是星期几
       * \_.dateUtil.getBeginDayOfMouth(2014, 3);     // 2014年3月1号是星期几
       */
      getBeginDayOfMouth: function (year, month) {
        //自动减一以便操作
        if (_.isDate(year)) {
          month = year.getMonth();
          year = year.getFullYear();
        } else {
          month--;
        }
        var d = new Date(year, month, 1);
        return d.getDay();
      }
    };

  })();
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="-_checkSelectedDown.html">_checkSelectedDown</a></li><li><a href="-_checkSelectedUp.html">_checkSelectedUp</a></li><li><a href="c.ui.imageSlider.html">imageSlider</a></li><li><a href="cAbstractModel.html">cAbstractModel</a></li><li><a href="cAbstractStore.html">cAbstractStore</a></li><li><a href="cBase.html">cBase</a></li><li><a href="cCoreInherit.html">cCoreInherit</a></li><li><a href="cModel.html">cModel</a></li><li><a href="cPageList.html">cPageList</a></li><li><a href="cSessionStore.html">cSessionStore</a></li><li><a href="cStore.html">cStore</a></li><li><a href="cUIInputClear.html">cUIInputClear</a></li><li><a href="cUserModel.ClientIdModel.html">ClientIdModel</a></li><li><a href="cUserModel.GetUserModel.html">GetUserModel</a></li><li><a href="cUserModel.NotUserLoginModel.html">NotUserLoginModel</a></li><li><a href="cUserModel.ThirdPartInfoModel.html">ThirdPartInfoModel</a></li><li><a href="cUserModel.UserLoginModel.html">UserLoginModel</a></li><li><a href="Service.cGeo.Address.html">Address</a></li><li><a href="Service.cGeo.City.html">City</a></li><li><a href="Service.cGeo.Coordinate.html">Coordinate</a></li><li><a href="Service.cGeo.Geolocation.html">Geolocation</a></li><li><a href="Service.cGeo.Map.html">Map</a></li><li><a href="Service.cGeo.Map.Icon.html">Icon</a></li><li><a href="Service.cGeo.Map.Layer.html">Layer</a></li><li><a href="Service.cGeo.Map.Mark.html">Mark</a></li><li><a href="Service.cGeo.MapS.html">MapS</a></li><li><a href="Service.cGeo.POI.html">POI</a></li><li><a href="Service.cGeo.POIQuery.html">POIQuery</a></li><li><a href="UICalendarCommon.html">UICalendarCommon</a></li><li><a href="UIScroll.html">UIScroll</a></li><li><a href="UIView.html">UIView</a></li><li><a href="Util.cUtilData.CData.html">CData</a></li><li><a href="Util.cUtilDate.CDate.html">CDate</a></li></ul><h3>Namespaces</h3><ul><li><a href="-_.dateUtil.html">dateUtil</a></li><li><a href="cAjax.html">cAjax</a></li><li><a href="Common.cMessageCenter.html">cMessageCenter</a></li><li><a href="Service.cGeo.html">Service.cGeo</a></li><li><a href="Storage.cAbstractStorage.html">cAbstractStorage</a></li><li><a href="Storage.cLocalStorage.html">cLocalStorage</a></li><li><a href="Storage.cMemoryStorage.html">cMemoryStorage</a></li><li><a href="Storage.cSessionStorage.html">cSessionStorage</a></li><li><a href="Store.cCommonStore.html">cCommonStore</a></li><li><a href="Store.cCommonStore.cHeadStore.html">cHeadStore</a></li><li><a href="Store.cCommonStore.cMobileTokenStore.html">cMobileTokenStore</a></li><li><a href="Store.cCommonStore.cUserStore.html">cUserStore</a></li><li><a href="Store.cMarketStore.html">cMarketStore</a></li><li><a href="Store.cMarketStore.SalesObjectStore.html">SalesObjectStore</a></li><li><a href="Store.cMarketStore.SalesStore.html">SalesStore</a></li><li><a href="Store.cMarketStore.UnionStore.html">UnionStore</a></li><li><a href="Store.cMemoryStore.html">cMemoryStore</a></li><li><a href="Util.cUtilCacheViews.html">cUtilCacheViews</a></li><li><a href="Util.cUtilCryptBase64.html">cUtilCryptBase64</a></li><li><a href="Util.cUtilCryptBase64.Base64.html">Base64</a></li><li><a href="Util.cUtilCryptRSA.html">cUtilCryptRSA</a></li><li><a href="Util.cUtilDate.html">cUtilDate</a></li><li><a href="Util.cUtilObject.html">cUtilObject</a></li><li><a href="Util.cUtilPath.html">cUtilPath</a></li><li><a href="Util.cUtilPerformance.html">cUtilPerformance</a></li><li><a href="Util.cUtilValidate.html">cUtilValidate</a></li><li><a href="Util.dgrid.html">dgrid</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_stores%255Bundefined%255D">_stores[undefined]</a></li><li><a href="global.html#abort">abort</a></li><li><a href="global.html#bindEvents">bindEvents</a></li><li><a href="global.html#bindthis">bindthis</a></li><li><a href="global.html#buildurl">buildurl</a></li><li><a href="global.html#childViewNames">childViewNames</a></li><li><a href="global.html#clearResult">clearResult</a></li><li><a href="global.html#cPageView#onCreateopts%257B%257D">cPageView#onCreate
            opts {
          }</a></li><li><a href="global.html#createElement">createElement</a></li><li><a href="global.html#createRoot">createRoot</a></li><li><a href="global.html#excute">excute</a></li><li><a href="global.html#execute">execute</a></li><li><a href="global.html#extension">extension</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getAttr">getAttr</a></li><li><a href="global.html#getBiggerzIndex">getBiggerzIndex</a></li><li><a href="global.html#getCookieVal">getCookieVal</a></li><li><a href="global.html#getCreateId">getCreateId</a></li><li><a href="global.html#getCurStyleOfEl">getCurStyleOfEl</a></li><li><a href="global.html#getDirtyItems">getDirtyItems</a></li><li><a href="global.html#getElementPos">getElementPos</a></li><li><a href="global.html#getElementRealSize">getElementRealSize</a></li><li><a href="global.html#getExpireTime">getExpireTime</a></li><li><a href="global.html#getMousePosOfElement">getMousePosOfElement</a></li><li><a href="global.html#getPageScrollPos">getPageScrollPos</a></li><li><a href="global.html#getPageSize">getPageSize</a></li><li><a href="global.html#getParam">getParam</a></li><li><a href="global.html#getQuery">getQuery</a></li><li><a href="global.html#getResult">getResult</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#InputClear">InputClear</a></li><li><a href="global.html#isUseH5Sys">isUseH5Sys</a></li><li><a href="global.html#key">key</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#presetData">presetData</a></li><li><a href="global.html#propertys">propertys</a></li><li><a href="global.html#pushValidates">pushValidates</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#removeAttr">removeAttr</a></li><li><a href="global.html#rollback">rollback</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#setAttr">setAttr</a></li><li><a href="global.html#setConfig">setConfig</a></li><li><a href="global.html#setExpireTime">setExpireTime</a></li><li><a href="global.html#setLifeTime">setLifeTime</a></li><li><a href="global.html#setParam">setParam</a></li><li><a href="global.html#showLog">showLog</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#strToNum">strToNum</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Oct 13 2016 13:38:14 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
