<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ui/calendar/ui.calendar.common.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ui/calendar/ui.calendar.common.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>﻿/**
* 统一日历组件
* @class
* @extends UIView
* @name UICalendarCommon
* @see http://conf.ctripcorp.com/pages/viewpage.action?pageId=58574731
* @example
* var calendar = new UICalendarCommon({
*   datamodel: {
*     startTime: new Date(),//开始可选日期
*     endTime: new Date(2015, 3, 20),//结束日期
*     displayMonthNum: 15//一共显示多少个月
*   },
*   wrapper: this.$('.js-calendar'),//日历包裹层
*    //点击日历项触发的事件
*   onItemClick: function (date, el, e) {
*
*   },
*   onShow: function() {},
*   onHide: function() {}
*   ...
* });
* calendar.show();
*/
define([
  '../ui.abstract.view',
  'dojo/text!./template/ui.calendar.common.html'
], function (UIView, template) {

  return _.inherit(UIView, /** @lends UICalendarCommon.prototype */{
    propertys: function ($super) {
      $super();
      //html模板
      this.template = template;

      //默认由服务器读出当前日期，考虑依赖没有做......******
      this.dateObj = new Date();

      //阳历节日
      this.solarHoliday = {
        '0101': '元旦',
        '0214': '情人节',
        '0501': '劳动节',
        '0601': '儿童节',
        '0910': '教师节',
        '1001': '国庆',
        '1225': '圣诞'
      };

      //阴历节日
      this.lunarHoliday = {
        '20150219': '春节',
        '20150305': '元宵',
        '20150405': '清明',
        '20150620': '端午',
        '20150927': '中秋',

        '20160208': '春节',
        '20160222': '元宵',
        '20160404': '清明',
        '20160609': '端午',
        '20160915': '中秋',

        '20170128': '春节',
        '20170211': '元宵',
        '20170404': '清明',
        '20170530': '端午',
        '20171004': '中秋',

        '20180216': '春节',
        '20180302': '元宵',
        '20180405': '清明',
        '20180618': '端午',
        '20180924': '中秋'

      };

      /**
       * 时区时差问题，用于跨城市，这里记录的是相对于北京东八区差距多少秒，计算时候需要*1000
       * 默认处于中国，以北京时间为准
       * @name UICalendarCommon#jetLag
       * @type {number}
       */
      this.jetLag = 0;

      //特殊时刻
      this.specialDates = false;

      //要求必须要传入日期对象
      /**
       * 默认的数据
       * @name UICalendarCommon#datamodel
       * @type {object}
       * @example
       * // 默认数据
       * calendar.datamodel = {
       *   startTime: new Date(),    // 开始时间 {date}
       *   endTime: null             // 结束时间 {date}
       *   displayMonthNum: 5        // 显示月份的数量 {number}
       *   selectDate: null          // 当前选择的日期 {date}
       *   MonthClapFn: function(year, month) {}  //分割月之间的显示
       *   dayItemFn: function(year, month, day, dateObj, difftime) {} //具体显示项目定制化
       * }
       */
      this.datamodel = {
        scope: this,
        startTime: null,
        endTime: null,
        weekDayArr: ['日', '一', '二', '三', '四', '五', '六'],
        displayMonthNum: 5,

        //包含时分秒的详细时间戳
        curTime: this.dateObj.getTime(),

        //当前选择的日期
        selectDate: null,
        //分割月之间的显示
        MonthClapFn: function (year, month) {
          month = month + 1;
          return year + '年' + (month) + '月';
        },
        //具体显示项目定制化
        dayItemFn: function (year, month, day, dateObj, difftime) {

          var dayObj = {
            day: day
          };
          var dayStrArr = [];
          var _solarHoliday = _.dateUtil.formatNum(month + 1) + _.dateUtil.formatNum(day);
          var _lunarHoliday = year.toString() + _.dateUtil.formatNum(month + 1) + _.dateUtil.formatNum(day);
          var _deffHour = parseInt(-1 * difftime / 3600000 * 100) / 100;

          //处理日
          if (_deffHour >= 0 &amp;&amp; _deffHour &lt; 24) {
            dayObj.day1 = '今天';
          } else if (_deffHour >= -24 &amp;&amp; _deffHour &lt; 0) {
            dayObj.day1 = '明天';
          } else if (_deffHour >= -48 &amp;&amp; _deffHour &lt; -24) {
            dayObj.day1 = '后天';
          }

          //处理节日
          if (this.solarHoliday[_solarHoliday]) {
            dayObj.solarHoliday = this.solarHoliday[_solarHoliday];
          }

          //阴历节日
          if (this.lunarHoliday[_lunarHoliday]) {
            dayObj.lunarHoliday = this.lunarHoliday[_lunarHoliday];
          }

          //处理特殊标志
          if (this.specialDates) {
            //默认不处理特殊标志，但是阴历需要处理
          }

          dayStrArr[0] = '&lt;div class="cm-field-title">' + (dayObj.day1 || dayObj.day) + '&lt;/div>';

          if (dayObj.solarHoliday || dayObj.lunarHoliday) {
            // 修复节日样式bug
            dayStrArr[0] = '&lt;div class="cm-field-title cm-field-title--festival">' + (dayObj.lunarHoliday || dayObj.solarHoliday) + '&lt;/div>';
          }

          if (this.dayItemAction) {
            return this.dayItemAction.call(this, dayObj, year, month, day, dateObj, difftime);
          }
          else {
            return dayStrArr.join('');
          }

        }
      };

      this.dayItemAction = null;

      this.events = {
        'click .js_calendar_item ': 'itemAction'
      };

      /**
       * 每一项点击的回调函数
       * @method UICalendarCommon#onItemClick
       * @param {object} date 当前日期对象
       * @param {object} el jQuery对象
       * @param {object} e 事件对象
       */
      this.onItemClick = function (date, el, e) {
        console.log(arguments);
      };
    },

    //要求唯一标识，根据id确定index
    resetPropery: function ($super) {
      $super();
      this.datamodel.deffTimezone = this.jetLag * 1000;

      //这里处理时区差问题，并且根据时区重置当前时间
      //存储由于时区导致的时间偏移
      //重置当前时间
      this.datamodel.curTime = this.dateObj.getTime() + this.datamodel.deffTimezone;

      //如果设置了startTime的话，需要由startTime开始计算
      if (!this.datamodel.startTime) {
        this.datamodel.startTime = this.dateObj;
      }

      //以startTime为标识取开始月份
      var dateObj = new Date(this.datamodel.startTime.getTime() + this.datamodel.deffTimezone);

      //当不开启时区功能的时候，略去这些逻辑
      if (this.datamodel.deffTimezone == '0'){
      	dateObj = new Date(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate());
      }

      this.datamodel.startTime = dateObj;

      this.datamodel.year = dateObj.getFullYear();
      this.datamodel.month = dateObj.getMonth();

      //结束日期
      this.datamodel.endDate = new Date(this.datamodel.year, this.datamodel.month + this.datamodel.displayMonthNum, 0);

    },

    //设置时区相差秒
    setJetLag: function (v) {
      this.jetLag = parseInt(v);
      this.refresh();
    },

    addDisplayMonth: function (num) {
      this.datamodel.displayMonthNum = this.datamodel.displayMonthNum + num;
      this.refresh();
    },

/**
 * 处理某一天，中国操作习惯，月份以1开始
 * @param {object|string} selectorDay
 * @param {function} callback 回调函数
 */
handleCnDay: function (selectorDay, callback) {
  var dayStr = selectorDay, dayArr = [], el;
  if (_.isDate(selectorDay)) {
    dayStr = selectorDay.getFullYear() + '-' + selectorDay.getMonth() + '-' + selectorDay.getDate();
  } else if (_.isString(selectorDay)) {
    dayArr = selectorDay.split('-');
    dayStr = dayArr[0] + '-' + (parseInt(dayArr[1]) - 1) + '-' + dayArr[2];
  }
  this.handleDay(dayStr, callback);
},

/**
 * 处理某一天
 * @param {object|string} selectorDay
 * @param {function} callback 回调函数
 */
handleDay: function (selectorDay, callback) {
  var dayStr = selectorDay, dayArr = [], el;

  if (_.isDate(selectorDay)) {
    dayStr = selectorDay.getFullYear() + '-' + selectorDay.getMonth() + '-' + selectorDay.getDate();
  }

  el = this.$('li[data-date="' + dayStr + '"]');
  if (el[0] &amp;&amp; _.isFunction(callback)) {
    callback.call(this, el);
  }
},

    itemAction: function (e) {
      var el = $(e.currentTarget);
      if (el.hasClass('cm-item--disabled')){
      	return;
      }
      var date = el.attr('data-date');
      date = date.split('-');
      if (date.length != 3){
      	return false;
      }

      date = new Date(date[0], date[1], date[2]);

      if (this.onItemClick){
      	this.onItemClick.call(this, date, el, e);
      }
    },

    initElement: function () {
      var styleRoot = $('#js_style_root');
      this.weekDay = this.$('.js_weekend');

      this.calendarStyle = this.$('.js_ui_calendar_v1');

      if(!styleRoot[0]) {
        styleRoot = $('&lt;div id="js_style_root">&lt;/div>');
        //styleRoot.insertBefore($('#main'));
        styleRoot.insertBefore($('body'));
      }

      if(!styleRoot.find('.js_ui_calendar_v1')[0]){
        styleRoot.append(this.calendarStyle);
      }
    },

    initialize: function ($super, opts) {
      $super(opts);
      // 修复hybrid没有h5头部bug
      if ($('#headerview').css('display') === 'none') {
        this.$('.js_weekend').css('top', 0);
      }
    }

  });

});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="-_checkSelectedDown.html">_checkSelectedDown</a></li><li><a href="-_checkSelectedUp.html">_checkSelectedUp</a></li><li><a href="c.ui.imageSlider.html">imageSlider</a></li><li><a href="cAbstractModel.html">cAbstractModel</a></li><li><a href="cAbstractStore.html">cAbstractStore</a></li><li><a href="cBase.html">cBase</a></li><li><a href="cCoreInherit.html">cCoreInherit</a></li><li><a href="cModel.html">cModel</a></li><li><a href="cPageList.html">cPageList</a></li><li><a href="cSessionStore.html">cSessionStore</a></li><li><a href="cStore.html">cStore</a></li><li><a href="cUIInputClear.html">cUIInputClear</a></li><li><a href="cUserModel.ClientIdModel.html">ClientIdModel</a></li><li><a href="cUserModel.GetUserModel.html">GetUserModel</a></li><li><a href="cUserModel.NotUserLoginModel.html">NotUserLoginModel</a></li><li><a href="cUserModel.ThirdPartInfoModel.html">ThirdPartInfoModel</a></li><li><a href="cUserModel.UserLoginModel.html">UserLoginModel</a></li><li><a href="Service.cGeo.Address.html">Address</a></li><li><a href="Service.cGeo.City.html">City</a></li><li><a href="Service.cGeo.Coordinate.html">Coordinate</a></li><li><a href="Service.cGeo.Geolocation.html">Geolocation</a></li><li><a href="Service.cGeo.Map.html">Map</a></li><li><a href="Service.cGeo.Map.Icon.html">Icon</a></li><li><a href="Service.cGeo.Map.Layer.html">Layer</a></li><li><a href="Service.cGeo.Map.Mark.html">Mark</a></li><li><a href="Service.cGeo.MapS.html">MapS</a></li><li><a href="Service.cGeo.POI.html">POI</a></li><li><a href="Service.cGeo.POIQuery.html">POIQuery</a></li><li><a href="UICalendarCommon.html">UICalendarCommon</a></li><li><a href="UIScroll.html">UIScroll</a></li><li><a href="UIView.html">UIView</a></li><li><a href="Util.cUtilData.CData.html">CData</a></li><li><a href="Util.cUtilDate.CDate.html">CDate</a></li></ul><h3>Namespaces</h3><ul><li><a href="-_.dateUtil.html">dateUtil</a></li><li><a href="cAjax.html">cAjax</a></li><li><a href="Common.cMessageCenter.html">cMessageCenter</a></li><li><a href="Service.cGeo.html">Service.cGeo</a></li><li><a href="Storage.cAbstractStorage.html">cAbstractStorage</a></li><li><a href="Storage.cLocalStorage.html">cLocalStorage</a></li><li><a href="Storage.cMemoryStorage.html">cMemoryStorage</a></li><li><a href="Storage.cSessionStorage.html">cSessionStorage</a></li><li><a href="Store.cCommonStore.html">cCommonStore</a></li><li><a href="Store.cCommonStore.cHeadStore.html">cHeadStore</a></li><li><a href="Store.cCommonStore.cMobileTokenStore.html">cMobileTokenStore</a></li><li><a href="Store.cCommonStore.cUserStore.html">cUserStore</a></li><li><a href="Store.cMarketStore.html">cMarketStore</a></li><li><a href="Store.cMarketStore.SalesObjectStore.html">SalesObjectStore</a></li><li><a href="Store.cMarketStore.SalesStore.html">SalesStore</a></li><li><a href="Store.cMarketStore.UnionStore.html">UnionStore</a></li><li><a href="Store.cMemoryStore.html">cMemoryStore</a></li><li><a href="Util.cUtilCacheViews.html">cUtilCacheViews</a></li><li><a href="Util.cUtilCryptBase64.html">cUtilCryptBase64</a></li><li><a href="Util.cUtilCryptBase64.Base64.html">Base64</a></li><li><a href="Util.cUtilCryptRSA.html">cUtilCryptRSA</a></li><li><a href="Util.cUtilDate.html">cUtilDate</a></li><li><a href="Util.cUtilObject.html">cUtilObject</a></li><li><a href="Util.cUtilPath.html">cUtilPath</a></li><li><a href="Util.cUtilPerformance.html">cUtilPerformance</a></li><li><a href="Util.cUtilValidate.html">cUtilValidate</a></li><li><a href="Util.dgrid.html">dgrid</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_stores%255Bundefined%255D">_stores[undefined]</a></li><li><a href="global.html#abort">abort</a></li><li><a href="global.html#bindEvents">bindEvents</a></li><li><a href="global.html#bindthis">bindthis</a></li><li><a href="global.html#buildurl">buildurl</a></li><li><a href="global.html#childViewNames">childViewNames</a></li><li><a href="global.html#clearResult">clearResult</a></li><li><a href="global.html#cPageView#onCreateopts%257B%257D">cPageView#onCreate
            opts {
          }</a></li><li><a href="global.html#createElement">createElement</a></li><li><a href="global.html#createRoot">createRoot</a></li><li><a href="global.html#excute">excute</a></li><li><a href="global.html#execute">execute</a></li><li><a href="global.html#extension">extension</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getAttr">getAttr</a></li><li><a href="global.html#getBiggerzIndex">getBiggerzIndex</a></li><li><a href="global.html#getCookieVal">getCookieVal</a></li><li><a href="global.html#getCreateId">getCreateId</a></li><li><a href="global.html#getCurStyleOfEl">getCurStyleOfEl</a></li><li><a href="global.html#getDirtyItems">getDirtyItems</a></li><li><a href="global.html#getElementPos">getElementPos</a></li><li><a href="global.html#getElementRealSize">getElementRealSize</a></li><li><a href="global.html#getExpireTime">getExpireTime</a></li><li><a href="global.html#getMousePosOfElement">getMousePosOfElement</a></li><li><a href="global.html#getPageScrollPos">getPageScrollPos</a></li><li><a href="global.html#getPageSize">getPageSize</a></li><li><a href="global.html#getParam">getParam</a></li><li><a href="global.html#getQuery">getQuery</a></li><li><a href="global.html#getResult">getResult</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#InputClear">InputClear</a></li><li><a href="global.html#isUseH5Sys">isUseH5Sys</a></li><li><a href="global.html#key">key</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#presetData">presetData</a></li><li><a href="global.html#propertys">propertys</a></li><li><a href="global.html#pushValidates">pushValidates</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#removeAttr">removeAttr</a></li><li><a href="global.html#rollback">rollback</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#setAttr">setAttr</a></li><li><a href="global.html#setConfig">setConfig</a></li><li><a href="global.html#setExpireTime">setExpireTime</a></li><li><a href="global.html#setLifeTime">setLifeTime</a></li><li><a href="global.html#setParam">setParam</a></li><li><a href="global.html#showLog">showLog</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#strToNum">strToNum</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Oct 13 2016 13:38:14 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
