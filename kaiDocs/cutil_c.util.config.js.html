<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cutil/c.util.config.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cutil/c.util.config.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
根据当前的url决定调用的接口环境 或者返回默认的接口环境
环境配置在文件:kaiFrame/src/kai/scripts/app/pc/config/interface.js
*/
define([
'./c.util.common',
'./c.util.route'
],function(
  cUtilCommon,
  routeUtil
){
  "use strict";
  var util = {

  };

  /*根据当前host和预先配置的环境信息来获得后台接口信息*/
  util.getEnvConfig = function(interfaceConfigCollection) {
    var host = location.host;/*根据当前的url决定调用的接口环境 或者返回默认的接口环境*/
    var env = null;//需要调用的接口信息
    var defaultEnv = null;//没有当前域名对应接口信息情况下使用的默认配置
    env = _.findWhere(interfaceConfigCollection,{
      host:host
    });
    if(!(_.isObject(env))){
      /*获取第一个配置为默认的接口信息*/
      defaultEnv = _.findWhere(interfaceConfigCollection,{
        isDefault:true
      });
      if(!(_.isObject(defaultEnv))){
        /*没有默认配置的话，返回第一个接口信息*/
        defaultEnv = interfaceConfigCollection[0];
      }
      env = defaultEnv || {};
    }
    _.extend(Kai,{
      env:env
    });
    return env;
  };

  /*
  返回环境接口信息
  */
  util.getBaseUrl = function(interfaceConfigCollection) {/*设置model的调用信息；根据当前的环境返回调用的接口信息*/
    var bdomain, bpath,protocol;
    var env = Kai.env || util.getEnvConfig(interfaceConfigCollection);
    if(env &amp;&amp; env.preventAlert){//如果配置中禁用alert弹窗
      cUtilCommon.preventAlert();
    }
    if(!env.protocol){
      env.protocol = Kai.protocol();
    }
    util.initTracker(env);
    return env;
  };

  util.initTracker = function(env){
    /*初始化tracker*/
    // 定义一个统计模块 self.viewName
    alog('define','VL', function(){
      var viewTracker = alog.tracker('VL');//view生命周期
      return viewTracker;
    });

    alog('define','PERF', function(){
      var performanceTracker = alog.tracker('PERF');//view生命周期
      return performanceTracker;
    });

    alog('define','UBT', function(){
      var ubtTracker = alog.tracker('UBT');//view生命周期
      return ubtTracker;
    });

    //创建统计模块的实例
    if(_.isObject(env.trackerPostUrl)){
      alog('VL.create', {
        postUrl: env.trackerPostUrl.viewLifecycle // 指定上传数据的 url 地址
      });
      alog('PERF.create', {
        postUrl: env.trackerPostUrl.performance // 指定上传数据的 url 地址
      });
      alog('UBT.create', {
        postUrl: env.trackerPostUrl.ubt // 指定上传数据的 url 地址
      });
    }
  };

  /**
  @param app: viewCollectionData,app.interfaceConfig
  */
  util.getConfig = function(app){
    return {
      routes:routeUtil.parse(app.viewCollectionData),
      envConfig:this.getEnvConfig(app.interfaceConfig)
    }
  }
  return util;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Util.cUtilData.CData.html">Util.cUtilData.CData</a></li><li><a href="Util.cUtilDate.CDate.html">Util.cUtilDate.CDate</a></li></ul><h3>Namespaces</h3><ul><li><a href="topic_c.topic.html">topic/c.topic</a></li><li><a href="Util.cUtilCacheViews.html">Util.cUtilCacheViews</a></li><li><a href="Util.cUtilCryptBase64.html">Util.cUtilCryptBase64</a></li><li><a href="Util.cUtilCryptBase64.Base64.html">Util.cUtilCryptBase64.Base64</a></li><li><a href="Util.cUtilCryptRSA.html">Util.cUtilCryptRSA</a></li><li><a href="Util.cUtilDate.html">Util.cUtilDate</a></li><li><a href="Util.cUtilObject.html">Util.cUtilObject</a></li><li><a href="Util.cUtilPath.html">Util.cUtilPath</a></li><li><a href="Util.cUtilPerformance.html">Util.cUtilPerformance</a></li><li><a href="Util.cUtilValidate.html">Util.cUtilValidate</a></li><li><a href="Util.dgrid.html">Util.dgrid</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getQuery">getQuery</a></li><li><a href="global.html#showLog">showLog</a></li><li><a href="global.html#showToast">showToast</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Oct 13 2016 18:08:16 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
