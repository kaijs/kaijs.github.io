<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: topic/c.topic.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: topic/c.topic.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @description:topic/c.topic
* @param {string} topicName - The title of the book.
* @param {string} source - The author of the book.
* @file topic/c.topic，可以在不同view之间发送以交换数据
* @author chenxiangyun01@chinatopcredit.com
* @example
//发布事件
trialNoteSaveRequireTopic.set('data', {
requestData: true,
isSubmit: false,
from:self.viewName,
fromParent:self.parentViewName
});
trialNoteSaveRequireTopic.publish();

//订阅事件
self.subscribe(trialNoteSaveRequireTopic, function(e) {
if(!self.viewName){
return false;
}
if(self.viewName &amp;&amp; self.viewName.indexOf(e.data.fromParent) &lt; 0){
return false;
}});
*/
define([
  "common/c.class.inherit",
  'dojo/topic',
  "topic/c.abstract.topic"
], function (
  cCoreInherit,
  topic,
  cAbstractTopic
) {

  /**
  * @description Topic父类，封装ajax访问, 该类可以直接被实例化
  * @namespace topic/c.topic
  * @alias topic/c.topic
  */
  var BaseTopic = new cCoreInherit.Class(cAbstractTopic,{

    __propertys__: function () {
      /**
      * 主题名称, 必填,全局唯一
      * @name topic/c.topic#topicName
      * @type {String}
      */
      this.topicName = '';

      /**
      * 目标页面名称列表,可选
      * @name topic/c.topic#target
      * @type {Array}
      */
      this.target = null;

      /**
      * 主题来源页面,必选
      * @name topic/c.topic#source
      * @type {String}
      */
      this.source = null,

      /**
      * 主题发送包含的数据,回调函数中可以获取，可选
      * @name topic/c.topic#data
      * @type {*}
      */
      this.data = null;

      /**
      * 当前状态
      * @name "topic/c.topic"#status
      * @type {Array}
      */
      this.status = null;

      /**
      * 订阅者集合,可选
      * @name "topic/c.topic"#subscribers
      * @type {Array}
      */
      this.subscribers = null;

      /**
      * 回调的函数MAP集合 {key:页面名称,value:对应的回调函数}
      * @name "topic/c.topic"#subscribers
      * @type {Object}
      */
      this.callbacksObj = null;
    },

    /**
    * 复写自顶层Class的initialize，赋值队列
    * @param {Object} options 初始化参数
    * @private
    */
    initialize: function ($super, options) {
      var self = this;
      if(_.isFunction($super)){
        $super(options);
      };
      topic.subscribe(self.topicName,function(e){
        $.proxy(self.executeCallback,self)(e);
      });
      this.callbacksObj = {
      };
      this.subscribers = [];
      this.target = [];
    },

    /**发送topic
    * @name topic/c.topic#publish
    * @method
    */
    publish:function(){
      topic.publish(this.topicName,{
        status: this.status,
        data:this.data,
        source:this.source,
        sourceParentViewName:this.sourceParentViewName,
        target:this.target || []
      });
    },

    /**订阅topic
    * @name topic/c.topic#subscribe
    * @method
    * @param {String} viewName - 页面名称
    * @param {Function} callback - 接受到主题后的回调函数
    */
    subscribe:function(viewName,callback){
      if(_.contains(this.subscribers,viewName)){//使用自己的viewName订阅事件
        //return false;//TBD replace the old callback instead
      }else{
        this.subscribers.push(viewName);
      }
      this.callbacksObj[viewName] = function(e){
        callback.apply(self,[e]);
      };
    },

    /**
    取消订阅主题
    * @name topic/c.topic#unsubscribe
    * @method
    * @param {String} viewName - 页面名称
    */
    unsubscribe:function(viewName){
      this.subscribers = _.without(this.subscribers,viewName);//从该topic中删除该监听者
      this.callbacksObj[viewName] = null;//回调函数中删除对应的回调
      delete this.callbacksObj[viewName];
    },

    /**
    * Assign the project to an employee.
    * @name topic/c.topic#addTarget
    * @private
    * @param {Object} employee - The employee who is responsible for the project.
    * @param {String} employee.name - The name of the employee.
    * @param {String} employee.department - The employee's department.
    */
    addTarget:function(targetArray){
      this.target.concat(targetArray || []);
    },

    /**
    设置属性
    * @name topic/c.topic#set
    * @method
    * @param {String} key - 属性名称
    * @param {*} data - 属性值
    * @return {Boolean}
    */
    set:function(key,data){
      this[key] = data;
      return true;
    },

    //执行订阅者回调
    executeCallback:function(e){//执行订阅者回调 前提是订阅，并且必需不是专题消息，如果是专题消息，目标用户应该包括你
      var self = this;
      _.each(self.subscribers,function(subscriber){
        if(_.isEmpty(e.target) || _.contains(e.target,subscriber)){//如果该主题的目标用户为空或则自己被包含在目标用户中
          self.callbacksObj[subscriber] &amp;&amp; self.callbacksObj[subscriber](e);
        }
      });
    }
  });
  /**
  * Topic的单例获取方式
  * @namespace topic/c.topic
  * @method cAbstractTopic.getInstance
  * @returns {Object}
  */
  BaseTopic.getInstance = function () {
    if (this.instance instanceof this) {
      return this.instance;
    } else {
      return this.instance = new this();
    }
  };
  return BaseTopic;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Util.cUtilData.CData.html">Util.cUtilData.CData</a></li><li><a href="Util.cUtilDate.CDate.html">Util.cUtilDate.CDate</a></li></ul><h3>Namespaces</h3><ul><li><a href="topic_c.topic.html">topic/c.topic</a></li><li><a href="Util.cUtilCacheViews.html">Util.cUtilCacheViews</a></li><li><a href="Util.cUtilCryptBase64.html">Util.cUtilCryptBase64</a></li><li><a href="Util.cUtilCryptBase64.Base64.html">Util.cUtilCryptBase64.Base64</a></li><li><a href="Util.cUtilCryptRSA.html">Util.cUtilCryptRSA</a></li><li><a href="Util.cUtilDate.html">Util.cUtilDate</a></li><li><a href="Util.cUtilObject.html">Util.cUtilObject</a></li><li><a href="Util.cUtilPath.html">Util.cUtilPath</a></li><li><a href="Util.cUtilPerformance.html">Util.cUtilPerformance</a></li><li><a href="Util.cUtilValidate.html">Util.cUtilValidate</a></li><li><a href="Util.dgrid.html">Util.dgrid</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getQuery">getQuery</a></li><li><a href="global.html#showLog">showLog</a></li><li><a href="global.html#showToast">showToast</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Oct 13 2016 18:08:16 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
